<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="https://i.imgur.com/93enhix.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BAKING SODA TRICK REVEAL</title>
    
    <!-- Hotjar Tracking Code for bluedrops v2 -->
    <script>
        (function(h,o,t,j,a,r){
            h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
            h._hjSettings={hjid:6454408,hjsv:6};
            a=o.getElementsByTagName('head')[0];
            r=o.createElement('script');r.async=1;
            r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
            a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>

    <!-- Utmify Tracking Code -->
    <script>
      window.pixelId = "681eb087803be4de5c3bd68b";
      var a = document.createElement("script");
      a.setAttribute("async", "");
      a.setAttribute("defer", "");
      a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
      document.head.appendChild(a);
    </script>

    <!-- ‚úÖ FIXED: Single Meta Pixel Implementation - NO DUPLICATES -->
    <script>
    (function() {
      'use strict';
      
      // ‚úÖ CRITICAL: Prevent ANY duplicate initialization
      if (window.fbqLoaded || window.fbq || document.querySelector('script[src*="fbevents.js"]')) {
        console.warn('üõ°Ô∏è Meta Pixel already exists, preventing duplicate initialization');
        return;
      }
      
      // ‚úÖ Mark as loading immediately
      window.fbqLoaded = true;
      window.fbqInitializing = true;
      
      console.log('üöÄ Initializing Meta Pixel (single instance)...');
      
      // ‚úÖ Standard Facebook Pixel code (single execution)
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      
      // ‚úÖ Initialize pixel with ID
      fbq('init', '1205864517252800');
      fbq('track', 'PageView');
      
      // ‚úÖ Mark as fully initialized
      window.fbqInitialized = true;
      window.fbqInitializing = false;
      
      console.log('‚úÖ Meta Pixel initialized successfully - ID: 1205864517252800');
      
      // ‚úÖ CRITICAL: Override fbq to prevent Purchase events on button clicks
      const originalFbq = window.fbq;
      window.fbq = function(action, event, data) {
        // ‚úÖ Block Purchase events that are not from thank you pages
        if (action === 'track' && event === 'Purchase') {
          const isThankYouPage = window.location.pathname.includes('thank') || 
                                window.location.pathname.includes('success') ||
                                window.location.pathname.includes('complete') ||
                                window.location.search.includes('thank') ||
                                window.location.search.includes('success');
          
          if (!isThankYouPage) {
            console.warn('üö´ BLOCKED Purchase event on non-thank-you page:', window.location.href);
            console.log('üí° Use InitiateCheckout for button clicks, Purchase only for completed orders');
            return;
          }
        }
        
        // ‚úÖ Block custom events (only allow standard events)
        if (action === 'trackCustom') {
          console.warn('üö´ BLOCKED custom event:', event, '- Only standard Facebook events allowed');
          return;
        }
        
        // ‚úÖ Allow all standard events
        return originalFbq.apply(this, arguments);
      };
      
      // ‚úÖ Copy properties from original fbq
      Object.keys(originalFbq).forEach(key => {
        if (typeof originalFbq[key] !== 'function') {
          window.fbq[key] = originalFbq[key];
        }
      });
      
      // ‚úÖ Monitor for duplicate scripts
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (node.nodeType === 1 && node.tagName === 'SCRIPT') {
              const script = node as HTMLScriptElement;
              if (script.src && script.src.includes('fbevents.js')) {
                const existingScripts = document.querySelectorAll('script[src*="fbevents.js"]');
                if (existingScripts.length > 1) {
                  console.error('üö® DUPLICATE Meta Pixel script detected and REMOVED:', script.src);
                  script.remove();
                }
              }
            }
          });
        });
      });
      
      observer.observe(document.head, { childList: true, subtree: true });
      observer.observe(document.body, { childList: true, subtree: true });
      
    })();
    </script>

    <!-- ‚úÖ RedTrack Universal Script - Load after Meta Pixel -->
    <script>
      // ‚úÖ Load RedTrack after Meta Pixel to prevent conflicts
      (function() {
        var script = document.createElement('script');
        script.src = 'https://rdt.obluemagicdrops.com/uniclick.js?attribution=lastpaid&cookiedomain=elaborate-smakager-4592e9.netlify.app&cookieduration=90&defaultcampaignid=68685bcb51f1690d1f917171&regviewonce=false';
        script.async = true;
        script.defer = true;
        
        script.onload = function() {
          console.log('‚úÖ RedTrack script loaded successfully');
        };
        
        script.onerror = function() {
          console.warn('‚ö†Ô∏è RedTrack script failed to load');
        };
        
        document.head.appendChild(script);
      })();
    </script>
  </head>
  <body>
    <!-- Meta Pixel noscript - moved to body -->
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1205864517252800&ev=PageView&noscript=1"
    /></noscript>
    
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>